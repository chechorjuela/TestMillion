import { useState } from 'react';
import { Modal } from '../atoms/Modal';
import { PropertyForm } from '../molecules/PropertyForm';
import { useDispatch } from 'react-redux';
import { addProperty } from '../../features/properties/propertySlice';

interface AddPropertyModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export const AddPropertyModal = ({ isOpen, onClose }: AddPropertyModalProps) => {
  const [isLoading, setIsLoading] = useState(false);
  const dispatch = useDispatch();

  const handleSubmit = async (data: any) => {
    try {
      setIsLoading(true);
      // Convert string values to numbers where needed
      const formattedData = {
        ...data,
        price: Number(data.price),
        year: Number(data.year),
        mainImage: data.mainImage || null
      };

      await dispatch(addProperty(formattedData) as any);
      onClose();
    } catch (error) {
      console.error('Error creating property:', error);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title="Add New Property"
    >
      <PropertyForm
        onSubmit={handleSubmit}
        onCancel={onClose}
        isLoading={isLoading}
      />
    </Modal>
  );
};